{
  "info": {
    "name": "Userservice API - Groups & Roles (ase-08)",
    "_postman_id": "ee98bc22-1983-4cde-aa12-8f48ed2497dc",
    "description": "Keycloak Gruppen- & Berechtigungsverwaltung (team-8, client_credentials). Alle Endpunkte unter /api/ase-08/**.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{access_token}}",
        "type": "string"
      }
    ]
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "const nowSec = Math.floor(Date.now()/1000);",
          "const exp = parseInt(pm.environment.get('token_expiry') || '0', 10);",
          "if (pm.environment.get('access_token') && (exp - nowSec) > 60) {",
          "  console.log('Existing token still valid');",
          "  return;",
          "}",
          "const kcUrl   = pm.environment.get('kcUrl')   || 'https://keycloak.sau-portal.de';",
          "const realm   = pm.environment.get('realm')   || 'sau';",
          "const clientId     = pm.environment.get('clientId')     || 'team-8';",
          "const clientSecret = pm.environment.get('clientSecret');",
          "const tokenUrl = `${kcUrl}/realms/${realm}/protocol/openid-connect/token`;",
          "let body = [",
          "  {key:'grant_type',    value:'client_credentials'},",
          "  {key:'client_id',     value: clientId},",
          "  {key:'client_secret', value: clientSecret}",
          "];",
          "pm.sendRequest({",
          "  url: tokenUrl,",
          "  method: 'POST',",
          "  header: {'Content-Type':'application/x-www-form-urlencoded'},",
          "  body: {mode:'urlencoded', urlencoded: body}",
          "}, function(err, res) {",
          "  if (err) {",
          "    console.log('Token request failed', err);",
          "    return;",
          "  }",
          "  const data = res.json();",
          "  pm.environment.set('access_token', data.access_token);",
          "  const ttl = parseInt(data.expires_in || '300', 10);",
          "  pm.environment.set('token_expiry', String(nowSec + ttl));",
          "  console.log('Token fetched, status', res.code);",
          "});"
        ]
      }
    }
  ],
  "item": [
    {
      "name": "Roles",
      "item": [
        {
          "name": "List Roles",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/roles",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "roles"
              ]
            }
          }
        },
        {
          "name": "Get Role by ID",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/roles/{{roleId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "roles",
                "{{roleId}}"
              ]
            }
          }
        },
        {
          "name": "Create Role",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/roles",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "roles"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"MyRole\"\n}"
            }
          }
        },
        {
          "name": "Update Role",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/roles/{{roleId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "roles",
                "{{roleId}}"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"MyRoleRenamed\"\n}"
            }
          }
        },
        {
          "name": "Add Permission to Role",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/roles/{{roleId}}/permissions",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "roles",
                "{{roleId}}",
                "permissions"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"permissionId\": \"{{permissionId}}\"\n}"
            }
          }
        },
        {
          "name": "Remove Permission from Role",
          "request": {
            "method": "DELETE",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/roles/{{roleId}}/permissions/{{permissionId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "roles",
                "{{roleId}}",
                "permissions",
                "{{permissionId}}"
              ]
            }
          }
        },
        {
          "name": "Get Standard Roles",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/standard-roles",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "standard-roles"
              ]
            }
          }
        },
        {
          "name": "Search Roles by Name",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/roles/search",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "roles",
                "search"
              ],
              "query": [
                {
                  "key": "name",
                  "value": "{{roleName}}"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Permissions",
      "item": [
        {
          "name": "List All Permissions",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/permissions",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "permissions"
              ]
            }
          }
        },
        {
          "name": "Get Permission by ID",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/permissions/{{permissionId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "permissions",
                "{{permissionId}}"
              ]
            }
          }
        },
        {
          "name": "Search Permissions by Name",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/permissions/search",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "permissions",
                "search"
              ],
              "query": [
                {
                  "key": "name",
                  "value": "{{permName}}"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Groups",
      "item": [
        {
          "name": "List Groups",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/groups",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "groups"
              ]
            }
          }
        },
        {
          "name": "List Standard Groups",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/groups/standard",
              "host": ["{{baseUrl}}"],
              "path": ["api", "ase-08", "groups", "standard"]
            }
          }
        },
        {
          "name": "Get Group by ID",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/groups/{{groupId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "groups",
                "{{groupId}}"
              ]
            }
          }
        },
        {
          "name": "Create Group",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/groups",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "groups"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"team-marketing\",\n  \"attributes\": {\n    \"department\": \"marketing\"\n  }\n}"
            }
          }
        },
        {
          "name": "Update Group",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/groups/{{groupId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "groups",
                "{{groupId}}"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"team-marketing-intl\",\n  \"attributes\": {\n    \"department\": \"marketing\",\n    \"region\": \"international\"\n  }\n}"
            }
          }
        },
        {
          "name": "Delete Group",
          "request": {
            "method": "DELETE",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/groups/{{groupId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "groups",
                "{{groupId}}"
              ]
            }
          }
        },
        {
          "name": "List Group Permissions",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/groups/{{groupId}}/permissions",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "groups",
                "{{groupId}}",
                "permissions"
              ]
            }
          }
        },
        {
          "name": "Add Permissions to Group",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/groups/{{groupId}}/permissions",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "groups",
                "{{groupId}}",
                "permissions"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"permissionIds\": [\"{{permissionId}}\"]\n}"
            }
          }
        },
        {
          "name": "Remove Permissions from Group",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/groups/{{groupId}}/permissions",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "groups",
                "{{groupId}}",
                "permissions"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"permissionIds\": [\"{{permissionId}}\"]\n}"
            }
          }
        },
        {
          "name": "Search Groups by Name",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/groups/search",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "groups",
                "search"
              ],
              "query": [
                {
                  "key": "name",
                  "value": "{{groupName}}"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Group Memberships",
      "item": [
        {
          "name": "List Users in Group",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/groups/{{groupId}}/users",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "groups",
                "{{groupId}}",
                "users"
              ],
              "query": [
                {
                  "key": "first",
                  "value": "0"
                },
                {
                  "key": "max",
                  "value": "50"
                }
              ]
            }
          }
        },
        {
          "name": "Add Users (bulk) to Group",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/groups/{{groupId}}/users",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "groups",
                "{{groupId}}",
                "users"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userIds\": [\"{{userId}}\"]\n}"
            }
          }
        },
        {
          "name": "Remove Users (bulk) from Group",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/groups/{{groupId}}/users",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "groups",
                "{{groupId}}",
                "users"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userIds\": [\"{{userId}}\"]\n}"
            }
          }
        },
        {
          "name": "Add Single User to Group",
          "request": {
            "method": "POST",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/users/{{userId}}/groups/{{groupId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "users",
                "{{userId}}",
                "groups",
                "{{groupId}}"
              ]
            }
          }
        },
        {
          "name": "Remove Single User from Group",
          "request": {
            "method": "DELETE",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/users/{{userId}}/groups/{{groupId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "users",
                "{{userId}}",
                "groups",
                "{{groupId}}"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Users",
      "item": [
        {
          "name": "Search Users (q)",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/users",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "users"
              ],
              "query": [
                {
                  "key": "q",
                  "value": "{{q}}"
                },
                {
                  "key": "first",
                  "value": "0"
                },
                {
                  "key": "max",
                  "value": "50"
                }
              ]
            }
          }
        },
        {
          "name": "Search Users by Name",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/users/search",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "users",
                "search"
              ],
              "query": [
                {
                  "key": "name",
                  "value": "{{userName}}"
                },
                {
                  "key": "first",
                  "value": "0"
                },
                {
                  "key": "max",
                  "value": "50"
                }
              ]
            }
          }
        },
        {
          "name": "Get User by ID",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/users/{{userId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "users",
                "{{userId}}"
              ]
            }
          }
        },
        {
          "name": "Get User Groups",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/users/{{userId}}/groups",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "users",
                "{{userId}}",
                "groups"
              ]
            }
          }
        },
        {
          "name": "Get User Effective Permissions",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/users/{{userId}}/permissions",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "users",
                "{{userId}}",
                "permissions"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Health",
      "item": [
        {
          "name": "Health",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/actuator/health",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "actuator",
                "health"
              ]
            }
          }
        },
        {
          "name": "Liveness",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/actuator/health/liveness",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "actuator",
                "health",
                "liveness"
              ]
            }
          }
        },
        {
          "name": "Readiness",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/ase-08/actuator/health/readiness",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "ase-08",
                "actuator",
                "health",
                "readiness"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Swagger",
      "item": [
        {
          "name": "OpenAPI JSON (ase-08)",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/v3/api-docs/ase-08",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v3",
                "api-docs",
                "ase-08"
              ]
            }
          }
        },
        {
          "name": "Swagger UI (ase-08)",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/ase-08/swagger-ui.html",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "ase-08",
                "swagger-ui.html"
              ]
            }
          }
        }
      ]
    }
  ]
}
